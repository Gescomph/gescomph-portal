  <div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">

      <mat-form-field id="establishments-plaza-select" appearance="outline">
        <mat-label>Plaza</mat-label>
        <mat-select (selectionChange)="onPlazaSelected($event.value)">
          <mat-option [value]="null">Todas</mat-option>
          <mat-option *ngFor="let plaza of plazas()" [value]="plaza.id">
            {{ plaza.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- üîç Buscador -->
      <mat-form-field id="establishments-search" class="search-field" appearance="outline">
        <mat-icon matPrefix>search</mat-icon>
        <input matInput placeholder="Buscar‚Ä¶" [formControl]="filterControl" type="text" />
      </mat-form-field>

      <!-- üë§ Bot√≥n Nuevo (solo para administradores con permiso CREAR) -->
      <ng-container *appHasRoleAndPermission="'Administrador'; perms: 'CREAR'">
        <app-standard-button id="establishments-new-btn" text="Nuevo establecimiento" variant="raised" color="primary" icon="add" iconPosition="left"
          (clicked)="openCreateDialog()" [disabled]="loadingCards()">
        </app-standard-button>
      </ng-container>
    </div>

    <!-- üåÄ Loading -->
    <ng-container *ngIf="loadingCards(); else content">
      <div class="d-flex justify-content-center mt-4">
        <mat-spinner></mat-spinner>
      </div>
    </ng-container>

    <!-- üì¶ Contenido -->
    <ng-template #content>
      <ng-container *ngIf="filteredEstablishments().length > 0; else noEstablishment">
        <div id="establishments-cards" class="d-flex flex-wrap gap-3 justify-content-center">
          <app-card *ngFor="let establishment of pagedCards()" [resource]="establishment" [showAvailableTag]="true"
            class="establishment-card"
            (delete)="handleDelete(establishment.id)" (view)="onView(establishment.id)"
            (edit)="openEditDialogById(establishment.id)">
          </app-card>
        </div>

        <!-- üìÑ Paginaci√≥n -->
        <mat-paginator id="establishments-paginator" [length]="filteredEstablishments().length" [pageSize]="pageSize()" [pageSizeOptions]="[6, 12, 18]"
          showFirstLastButtons (page)="onPageChange($event)">
        </mat-paginator>
      </ng-container>
    </ng-template>

    <!--  Si no hay resultados -->
    <ng-template #noEstablishment>
      <div class="text-center text-muted mt-4">
        No hay establecimientos que coincidan con la b√∫squeda.
      </div>
    </ng-template>

  </div>
