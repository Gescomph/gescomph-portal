  <mat-horizontal-stepper linear #stepper class="form-stepper">

    <!-- Paso 1 -->
    <mat-step [stepControl]="generalGroup">
      <form [formGroup]="generalGroup" class="form-step" autocomplete="off" spellcheck="false">
        <ng-template matStepLabel>Datos del Local</ng-template>

        <div class="section-header">
          <h3>Información Básica del Local</h3>
        </div>

        <div class="form-grid">

          <div class="field-with-error col-span-2">
            <mat-form-field appearance="outline">
              <mat-label>Nombre</mat-label>
              <input matInput formControlName="name" placeholder="Local 15 - Carnicería..." required (blur)="onTrim(generalGroup.get('name'))"/>
              <mat-hint>{{ generalGroup.get('name')?.value?.length || 0 }}/100</mat-hint>
            </mat-form-field>
            <app-form-error [control]="generalGroup.get('name')" label="Nombre"></app-form-error>
          </div>

          <div class="field-with-error">
            <mat-form-field appearance="outline">
              <mat-label>Área (m²)</mat-label>
              <input matInput type="number" formControlName="areaM2" required step="0.01" min="1"
                placeholder="25.50" (blur)="onNumberBlur(generalGroup.get('areaM2'))"/>
            </mat-form-field>
            <app-form-error [control]="generalGroup.get('areaM2')" label="Área (m²)"></app-form-error>
          </div>

          <div class="field-with-error">
            <mat-form-field appearance="outline">
              <mat-label class="field-label-with-icon">
                UVT
                <button mat-icon-button type="button" matTooltip="Unidad de Valor Tributario" class="label-info-button">
                  <mat-icon>info</mat-icon>
                </button>
              </mat-label>
              <input matInput type="number" formControlName="uvtQty" required step="0.01" min="1"
                placeholder="2.5" (blur)="onNumberBlur(generalGroup.get('uvtQty'))"/>
            </mat-form-field>
            <app-form-error [control]="generalGroup.get('uvtQty')" label="UVT"></app-form-error>
          </div>
        </div>

        <div class="field-with-error mt-2 w-100">
          <mat-form-field appearance="outline">
            <mat-label>Descripción</mat-label>
            <textarea matInput rows="3" formControlName="description" required
              placeholder="Local comercial en el primer piso..." (blur)="onTrim(generalGroup.get('description'))"></textarea>
            <mat-hint>{{ generalGroup.get('description')?.value?.length || 0 }}/500</mat-hint>
          </mat-form-field>
          <app-form-error [control]="generalGroup.get('description')" label="Descripción"></app-form-error>
        </div>

        <div class="form-actions">
          <app-standard-button text="Cancelar" variant="stroked" (clicked)="cancel()" [disabled]="isBusy"></app-standard-button>
          <app-standard-button text="Siguiente" variant="raised" color="primary"
            icon="arrow_forward" iconPosition="right" (clicked)="stepper.next()" [disabled]="generalGroup.invalid || isBusy">
          </app-standard-button>
        </div>
      </form>
    </mat-step>

    <!-- Paso 2 -->
    <mat-step [stepControl]="ubicacionGroup">
      <form [formGroup]="ubicacionGroup" class="form-step" autocomplete="off" spellcheck="false">
        <ng-template matStepLabel>Ubicación</ng-template>

        <div class="section-header">
          <h3>Ubicación del Local</h3>
        </div>

        <div class="field-with-error w-100 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Plaza</mat-label>
            <mat-select formControlName="plazaId" required>
              <mat-option *ngFor="let plaza of Squares; trackBy: trackByIndex" [value]="plaza.id">
                {{ plaza.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <app-form-error [control]="ubicacionGroup.get('plazaId')" label="Plaza"></app-form-error>
        </div>

        <div class="field-with-error w-100 mb-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Dirección</mat-label>
            <input matInput formControlName="address" placeholder="Carrera 7 # 14 - 28"
              (blur)="onTrim(ubicacionGroup.get('address'))"/>
          </mat-form-field>
          <app-form-error [control]="ubicacionGroup.get('address')" label="Dirección"></app-form-error>
        </div>

        <div class="form-actions space-between">
          <app-standard-button text="Cancelar" variant="stroked" (clicked)="cancel()" [disabled]="isBusy"></app-standard-button>
          <app-standard-button text="Anterior" variant="flat" icon="arrow_back"
            (clicked)="stepper.previous()" [disabled]="isBusy"></app-standard-button>
          <app-standard-button text="Siguiente" variant="raised" color="primary"
            icon="arrow_forward" iconPosition="right" (clicked)="stepper.next()" [disabled]="ubicacionGroup.invalid || isBusy">
          </app-standard-button>
        </div>
      </form>
    </mat-step>

    <!-- Paso 3 -->
    <mat-step>
      <ng-template matStepLabel>Imágenes</ng-template>
      <div class="form-step">
        <div class="section-header"><h3>Imágenes del Local</h3></div>

        <app-image-manager
          [max]="MAX_IMAGES"
          [existingImages]="existingImagesFull"
          [previews]="imagesPreview"
          (filesAdded)="onFilesAdded($event)"
          (removeExisting)="removeImage($event,true)"
          (removeNew)="removeImage($event,false)"
        ></app-image-manager>

        <div class="form-actions space-between">
          <app-standard-button text="Cancelar" variant="stroked" (clicked)="cancel()" [disabled]="isBusy"></app-standard-button>
          <app-standard-button text="Anterior" variant="flat" icon="arrow_back"
            (clicked)="stepper.previous()" [disabled]="isBusy"></app-standard-button>
          <app-standard-button [text]="isEdit?'Guardar cambios':'Guardar'" variant="raised"
            color="primary" icon="save" (clicked)="onSubmit()" [disabled]="generalGroup.invalid || ubicacionGroup.invalid || isBusy">
          </app-standard-button>
        </div>
      </div>
    </mat-step>

  </mat-horizontal-stepper>
