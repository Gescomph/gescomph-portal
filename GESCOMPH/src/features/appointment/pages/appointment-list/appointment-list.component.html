<div class="row d-flex justify-content-center">
  <app-generic-table
    id="appointments-table"
    [data]="appointments()"
    [columns]="columns"
    [titulo]="'GestiÃ³n de Citas'"
    [showActionsColumn]="false"
    [subTitulo]="'Administra las citas del sistema'"
    [showDetailButton]="false">
  </app-generic-table>

  <ng-template #userTemplate let-row>
    <div class="fw-semibold">{{ row.personName }}</div>
    <small class="text-muted">Tel: {{ row.phone || 'N/D' }}</small>
  </ng-template>

  <ng-template #onlyDateTpl let-row>
    {{ row.requestDate | date:'dd/MM/yyyy' }}
  </ng-template>

  <ng-template #dateTimeTpl let-row>
    {{ row.dateTimeAssigned | date:'dd/MM/yyyy HH:mm' }}
  </ng-template>

  <ng-template #statusTemplate let-row>
    <span
      class="status-chip"
      [ngClass]="{
        'status-chip--pending': (row.status ?? AppointmentStatusEnum.Pendiente) === AppointmentStatusEnum.Pendiente,
        'status-chip--approved': row.status === AppointmentStatusEnum.Aprobada,
        'status-chip--rejected': row.status === AppointmentStatusEnum.Rechazada
      }">
      {{ row.statusName || 'Pendiente' }}
    </span>
  </ng-template>

  <ng-template #actionsTemplate let-row>
    <div class="d-inline-flex align-items-center gap-2">
      <button
        mat-icon-button
        matTooltip="Ver detalle"
        (click)="onView(row)"
        aria-label="Ver detalle">
        <mat-icon>visibility</mat-icon>
      </button>

      <button
        mat-icon-button
        matTooltip="Aprobar cita"
        color="primary"
        [disabled]="(row.status ?? AppointmentStatusEnum.Pendiente) !== AppointmentStatusEnum.Pendiente || isProcessing(row.id, 'accept')"
        (click)="onAccept(row)"
        aria-label="Aprobar cita">
        <mat-icon *ngIf="!isProcessing(row.id, 'accept')">task_alt</mat-icon>
        <mat-progress-spinner
          *ngIf="isProcessing(row.id, 'accept')"
          diameter="20"
          mode="indeterminate">
        </mat-progress-spinner>
      </button>

      <button
        mat-icon-button
        matTooltip="Rechazar cita"
        color="warn"
        [disabled]="(row.status ?? AppointmentStatusEnum.Pendiente) !== AppointmentStatusEnum.Pendiente || isProcessing(row.id, 'reject')"
        (click)="onReject(row)"
        aria-label="Rechazar cita">
        <mat-icon *ngIf="!isProcessing(row.id, 'reject')">block</mat-icon>
        <mat-progress-spinner
          *ngIf="isProcessing(row.id, 'reject')"
          diameter="20"
          mode="indeterminate">
        </mat-progress-spinner>
      </button>
    </div>
  </ng-template>
</div>
